<main class="admin-reports-container">
  <h2>Reportes</h2>

  @if (isLoading) {
  <p>Cargando reportes...</p>
  }

  @if (errorMsg) {
  <p class="error">{{ errorMsg }}</p>
  }

  @if (!isLoading && reports.length === 0) {
  <p>No hay reportes ðŸŽ‰</p>
  }

  @if (!isLoading && reports.length > 0) {
  <section class="reports-columns">

    <!-- PENDIENTES -->
    <div class="reports-column">
      <h3>Pendientes</h3>

      @if (pendingReports.length === 0) {
      <p class="empty-msg">No hay reportes pendientes.</p>
      } @else {
      @for (rep of pendingReports; track rep.id) {
      <article class="report-card">
        <p><strong>Tipo:</strong> {{ rep.type }}</p>
        <p><strong>Motivo:</strong> {{ rep.reason }}</p>

        <p>
          <strong>Reportado por:</strong>
          <button type="button" class="link-profile" (click)="goToProfile(rep)">
            {{ rep.reporterName || ('ID ' + rep.reporterId) }}
          </button>
        </p>

        <p><strong>Fecha:</strong> {{ rep.createdAt | date:'short' }}</p>

        @if (rep.idMovie) {
        <p>
          <strong>PelÃ­cula:</strong>
          <button type="button" class="link-movie" (click)="goToMovie(rep)">
            Ver pelÃ­cula
          </button>
        </p>
        }

        <div class="actions">
          <button type="button" class="ok" (click)="changeStatus(rep, 'resolved')">âœ” Resolver</button>
          <button type="button" class="cancel" (click)="changeStatus(rep, 'dismissed')">âœ– Descartar</button>

          @if (isSuperAdmin) {
          <button type="button" class="delete" (click)="deleteReport(rep)">ðŸ—‘ Eliminar</button>
          }
        </div>

      </article>
      }
      }
    </div>

    <!-- RESUELTOS -->
    <div class="reports-column">
      <h3>Resueltos</h3>

      @if (resolvedReports.length === 0) {
      <p class="empty-msg">No hay reportes resueltos.</p>
      } @else {
      @for (rep of resolvedReports; track rep.id) {
      <article class="report-card resolved">
        <p><strong>Tipo:</strong> {{ rep.type }}</p>
        <p><strong>Motivo:</strong> {{ rep.reason }}</p>

        <p>
          <strong>Reportado por:</strong>
          <button type="button" class="link-profile" (click)="goToProfile(rep)">
            {{ rep.reporterName || ('ID ' + rep.reporterId) }}
          </button>
        </p>

        <p><strong>Fecha:</strong> {{ rep.createdAt | date:'short' }}</p>

        @if (rep.idMovie) {
        <p>
          <strong>PelÃ­cula:</strong>
          <button type="button" class="link-movie" (click)="goToMovie(rep)">
            Ver pelÃ­cula
          </button>
        </p>
        }

        <div class="actions">
          <button type="button" class="back" (click)="changeStatus(rep, 'pending')">
            â†© Volver a pendiente
          </button>

          @if (isSuperAdmin) {
          <button type="button" class="delete" (click)="deleteReport(rep)">ðŸ—‘ Eliminar</button>
          }
        </div>

      </article>
      }
      }
    </div>

    <!-- DESCARTADOS -->
    <div class="reports-column">
      <h3>Descartados</h3>

      @if (dismissedReports.length === 0) {
      <p class="empty-msg">No hay reportes descartados.</p>
      } @else {
      @for (rep of dismissedReports; track rep.id) {
      <article class="report-card dismissed">
        <p><strong>Tipo:</strong> {{ rep.type }}</p>
        <p><strong>Motivo:</strong> {{ rep.reason }}</p>

        <p>
          <strong>Reportado por:</strong>
          <button type="button" class="link-profile" (click)="goToProfile(rep)">
            {{ rep.reporterName || ('ID ' + rep.reporterId) }}
          </button>
        </p>

        <p><strong>Fecha:</strong> {{ rep.createdAt | date:'short' }}</p>

        @if (rep.idMovie) {
        <p>
          <strong>PelÃ­cula:</strong>
          <button type="button" class="link-movie" (click)="goToMovie(rep)">
            Ver pelÃ­cula
          </button>
        </p>
        }

        <div class="actions">
          <button type="button" class="back" (click)="changeStatus(rep, 'pending')">
            â†© Volver a pendiente
          </button>

          @if (isSuperAdmin) {
          <button type="button" class="delete" (click)="deleteReport(rep)">ðŸ—‘ Eliminar</button>
          }
        </div>

      </article>
      }
      }
    </div>

  </section>
  }
</main>