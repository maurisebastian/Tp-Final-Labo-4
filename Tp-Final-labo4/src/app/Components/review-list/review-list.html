<div class="review-section">

  <!-- Card: formulario para agregar rese√±a -->
  <div class="add-review">

    <h3 class="section-title">Agrega tu rese√±a</h3>

    <form [formGroup]="reviewForm" (submit)="addReview($event)">

      <div class="star-rating mb-3">

        @for (star of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]; track $index) {
        <span (click)="setStarRating(star)" class="star" [class.selected]="star <= +reviewForm.controls.score.value">
          ‚òÖ
        </span>
        }

        <span class="rating-label">
          Calificaci√≥n: {{ reviewForm.get('score')?.value || 0 }} / 10
        </span>
      </div>

      @if (reviewForm.get('score')?.invalid && reviewForm.get('score')?.touched) {
      <div class="text-danger">
        * La calificaci√≥n es obligatoria y debe estar entre 1 y 10.
      </div>
      }

      <textarea formControlName="description" placeholder="Escribe tu rese√±a aqu√≠..."
        class="review-textarea"></textarea>

      @if (reviewForm.get('description')?.invalid && reviewForm.get('description')?.touched) {
      <div class="text-danger">
        * La descripci√≥n es obligatoria y debe tener al menos 5 caracteres.
      </div>
      }

      <button type="submit" class="btn-primary" [disabled]="reviewForm.invalid">
        Agregar rese√±a
      </button>

    </form>

  </div>

  <!-- Card: listado de rese√±as -->
  <div class="reviews-list-block">

    <h3 class="section-title">Rese√±as</h3>

    @if (reviews.length === 0) {
    <span class="empty-reviews">
      No hay rese√±as disponibles para esta pel√≠cula.
    </span>
    }

    @for (review of reviews; track review.id) {

    <div class="card-rese√±as">

      <div class="review-info">

        <strong>
          Usuario: {{ review.userName || review.idProfile }}
        </strong>

        <span class="review-score">
          <strong>Calificaci√≥n:</strong> {{ review.score }} / 10
        </span>

      </div>
            <button class="btn-like" (click)="toggleLike(review)">
        @if (review.likedByUser) {
        ‚ù§Ô∏è {{ review.likesCount }}
        } @else {
        ü§ç {{ review.likesCount }}
        }
      </button>

      <button class="btn-report" (click)="reportReview(review)">
        üö© Reportar rese√±a
      </button>

            @if (review.idProfile === userId || isAdmin) {
      <button class="btn-delete" (click)="deleteReview(review.id)">
        Eliminar
      </button>
      }



    </div>

    <p class="review-description">{{ review.description }}</p>

    <!-- COMENTARIOS DE LA REVIEW -->

    <div class="comments-block">

      @if (review.comments?.length === 0) {
      <p class="no-comments">No hay comentarios a√∫n.</p>
      }

            @for (comment of review.comments; track comment.id) {
      <div class="comment-item">
        <strong>{{ comment.userName || comment.idProfile }}:</strong>
        <span>{{ comment.comment }}</span>

        <button
          type="button"
          class="btn-report-comment"
          (click)="reportComment(review, comment)"
        >
          üö©
        </button>
      </div>
      }


      @if (userLoggedIn) {
      <form (submit)="addComment($event, review)">
        <input type="text" [formControl]="getControl(review.id!)" class="form-control"
          placeholder="Escribe un comentario...">
        <button type="submit">Comentar</button>
      </form>
      }
    </div>

    }

  </div>


</div>