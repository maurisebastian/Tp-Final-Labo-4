<app-top-bar></app-top-bar>

@if (movieDetails) {

  <div class="movie-details">

    <!-- üîπ P√≥ster TMDB -->
    @if (!movieIsLocal) {
      <img
        class="movie-poster"
        [src]="'https://image.tmdb.org/t/p/w500' + movieDetails.poster_path"
        [alt]="movieDetails.title" />
    }
    <!-- üîπ P√≥ster local -->
    @else {
      <img
        class="movie-poster"
        [src]="movieDetails.poster_path || 'assets/placeholder-movie.png'"
        [alt]="movieDetails.title" />
    }

    <div class="movie-details-content">
      <h1>{{ movieDetails.title }}</h1>

      <!-- üîπ BOT√ìN ADMIN: OCULTAR / MOSTRAR + MOTIVO (solo TMDB, no locales) -->
      @if (isAdmin && !movieIsLocal) {
        <div class="movie-admin-banner">
          <button type="button" (click)="toggleHiddenFromDetail()">
            {{ isHidden ? 'Mostrar pel√≠cula al p√∫blico' : 'Ocultar pel√≠cula' }}
          </button>

          @if (isHidden && hiddenReason) {
            <p class="hidden-info">
              Esta pel√≠cula est√° oculta para los usuarios.<br />
              <strong>Motivo:</strong> {{ hiddenReason }}
            </p>
          }
        </div>
      }

      @if (movieDetails.overview) {
        <p><strong>Resumen:</strong> {{ movieDetails.overview }}</p>
      }

      <!-- üîπ Datos extra solo si NO es local (TMDB) -->
      @if (!movieIsLocal) {
        <p><strong>Fecha de lanzamiento:</strong> {{ movieDetails.release_date }}</p>
        <p><strong>Duraci√≥n:</strong> {{ movieDetails.runtime }} minutos</p>
        <p><strong>Calificaci√≥n:</strong> {{ movieDetails.vote_average }}</p>

        <p><strong>G√©neros:</strong></p>
        @for (genre of movieDetails.genres; track $index) {
          <span>* {{ genre.name }}</span>
        }
      }

      <!-- ‚≠ê REPARTO (solo TMDB) -->
      @if (!movieIsLocal) {
        <section class="cast-section">
          <h2>Reparto principal</h2>

          @if (cast && cast.length) {
            <div class="cast-grid">
              @for (actor of cast; track actor.id) {
                <article class="cast-card">
                  <img
                    [src]="actor.profile_path
                      ? 'https://image.tmdb.org/t/p/w185' + actor.profile_path
                      : 'assets/placeholder-actor.png'"
                    [alt]="actor.name" />

                  <p class="cast-name">{{ actor.name }}</p>
                  <p class="cast-character">Como: {{ actor.character }}</p>
                </article>
              }
            </div>
          } @else {
            <p>No hay informaci√≥n de actores disponible.</p>
          }
        </section>
      }
      <!-- ‚≠ê FIN REPARTO -->

      <hr />

      <!-- üîπ Botones de actividad solo para usuarios logueados -->
      @if (userId) {

        <div class="activity-buttons">

          @if (!isAdmin) {
            <button class="btn-activity watched" (click)="markAs('watched')">
              ‚úî Marcar como vista
            </button>

            <button class="btn-activity towatch" (click)="markAs('towatch')">
              ‚ûï Guardar para ver m√°s tarde
            </button>
          }

          <!-- Mensajes de estado de la pel√≠cula -->
          @if (activity?.status === 'watched') {
            <p class="watch-date done">
              ‚úî Vista el:
              <strong>{{ activity?.watchedDate | date:'shortDate' }}</strong>
            </p>
          } @else if (activity?.status === 'towatch') {
            <p class="watch-date pending">
              ‚ûï Guardada para ver m√°s tarde
            </p>
          }

        </div>

      } @else {
        <p>Inicia sesi√≥n para guardar esta pel√≠cula.</p>
      }

    </div>
  </div>
}

<!-- üîπ Rese√±as (funcionan para TMDB y locales) -->
<app-review-list [peliculaID]="movieId"></app-review-list>

<footer></footer>
